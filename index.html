<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Birthday Portal</title>
    <style>
        body { background: #0d0d0d; color: #ffffff; font-family: sans-serif; text-align: center; padding: 15px; overflow-x: hidden; }
        .card { background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; margin: 15px auto; max-width: 400px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); position: relative; z-index: 10; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: 1px solid #444; background: #262626; color: #fff; box-sizing: border-box; }
        button { background: #1a73e8; color: white; border: none; padding: 15px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .success-text { color: #4caf50; }
        .user-img { width: 100%; max-width: 200px; border-radius: 10px; margin-bottom: 15px; display: none; }
        #birthdayPage, #adminPage { display: none; }
        .balloon { position: fixed; bottom: -100px; width: 30px; height: 40px; border-radius: 50%; z-index: 1; animation: float 8s linear infinite; }
        @keyframes float { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-120vh); opacity: 0; } }
    </style>
</head>
<body>
    <div id="loginSection" class="card">
        <h2>Access Portal</h2>
        <input type="text" id="userCode" placeholder="Enter Code">
        <button onclick="checkCode()">Unlock</button>
    </div>

    <div id="birthdayPage" class="card">
        <h1 class="success-text">Happy Birthday</h1>
        <img id="dispImg" class="user-img" src="">
        <h2 id="dispName"></h2>
        <p id="dispMsg"></p>
        <button onclick="location.reload()" style="background:#333;">Exit</button>
    </div>

    <div id="adminPage">
        <h2>Admin Dashboard</h2>
        <div id="adminInputs"></div>
        <button onclick="saveAdminData()" style="background:#d32f2f;">Save All Changes</button>
        <button onclick="location.reload()" style="background:#333;">Back</button>
    </div>

    <script>
        const adminSecret = "867055";
        const thingSpeakKey = "QRBMLUH6LKE3ZZSJ"; // PUT YOUR WRITE KEY HERE

        let users = JSON.parse(localStorage.getItem('bdayData')) || {
            "1": { name: "Friend 1", age: "20", dob: "01-01", wish: "HBD!", msg: "Msg", code: "1001", img: "" },
            "2": { name: "Friend 2", age: "20", dob: "01-01", wish: "HBD!", msg: "Msg", code: "1002", img: "" }
        };

        function updateESP(val) {
            fetch(`https://api.thingspeak.com/update?api_key=${thingSpeakKey}&field1=${val}`);
        }

        function checkCode() {
            const entered = document.getElementById("userCode").value;
            if (entered === adminSecret) {
                updateESP(1); // 1 = Admin
                showAdmin();
                return;
            }
            let found = false;
            for (let id in users) {
                if (users[id].code === entered && entered !== "") {
                    updateESP(2); // 2 = User
                    showUser(users[id]);
                    found = true; break;
                }
            }
            if (!found) {
                updateESP(3); // 3 = Fail
                alert("Invalid Code");
            }
        }

        function showUser(user) {
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("birthdayPage").style.display = "block";
            document.getElementById("dispName").innerText = user.name;
            document.getElementById("dispMsg").innerText = user.msg;
            if(user.img) { document.getElementById("dispImg").src = user.img; document.getElementById("dispImg").style.display = "block"; }
        }

        function showAdmin() {
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("adminPage").style.display = "block";
        }
    </script>
</body>
</html>
