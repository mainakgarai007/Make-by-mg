<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Birthday Surprise Portal</title>
    <style>
        body { background: #0d0d0d; color: #fff; font-family: sans-serif; text-align: center; overflow-x: hidden; margin: 0; }
        .card { background: #1a1a1a; padding: 20px; border-radius: 15px; border: 1px solid #333; margin: 15px auto; max-width: 400px; position: relative; z-index: 10; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        input, textarea { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: 1px solid #444; background: #262626; color: #fff; box-sizing: border-box; }
        button { background: #1a73e8; color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        button:hover { opacity: 0.8; }
        
        /* Balloon Animation */
        .balloon { position: fixed; top: -100px; font-size: 30px; z-index: 1; animation: fall 5s linear forwards; }
        @keyframes fall { to { transform: translateY(110vh); } }

        /* Gift Animation */
        #giftSection { margin-top: 20px; display: none; cursor: pointer; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        #secretMsg { display: none; background: #222; padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px dashed #ff9800; }
        
        #birthdayPage, #adminPage { display: none; padding: 20px; }
        .admin-item { background: #222; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: left; border: 1px solid #444; }
        .feedback-item { padding: 10px; border-bottom: 1px solid #333; color: #4caf50; font-size: 14px; }
    </style>
</head>
<body>

    <div id="loginSection" class="card" style="margin-top: 80px;">
        <h2 style="color: #1a73e8;">Surprise Portal</h2>
        <p style="color: #888;">Enter your special code to unlock</p>
        <input type="text" id="userCode" placeholder="Enter Code Here">
        <button onclick="checkCode()">Unlock Now üîì</button>
    </div>

    <div id="birthdayPage">
        <h1 style="color:#ff9800; font-size: 45px; margin-bottom: 5px;" id="dispWish"></h1>
        <h2 style="font-size: 32px; margin-top: 0;">Name: <span id="dispName" style="color:#4caf50;"></span></h2>
        <h3 style="background: #222; display: inline-block; padding: 5px 15px; border-radius: 20px;">
            Age: <span id="dispAge"></span> | DOB: <span id="dispDOB"></span>
        </h3>
        <p id="dispMsg" style="font-size: 19px; line-height: 1.6; margin: 20px auto; max-width: 500px; color: #ccc;"></p>

        <div id="giftSection" onclick="openGift()">
            <div style="font-size: 70px;">üéÅ</div>
            <p style="color: #ff9800;"><strong>Click the gift to open!</strong></p>
        </div>
        <div id="secretMsg">
            <strong style="color: #ff9800; text-transform: uppercase;">‚ú® Secret Message ‚ú®</strong> 
            <p id="dispSecret" style="font-style: italic; font-size: 18px; margin-top: 10px;"></p>
        </div>

        <div class="card" style="margin-top: 40px; border-color: #e91e63;">
            <h3 style="color: #e91e63;">Leave a Feedback</h3>
            <textarea id="feedbackInput" placeholder="Write your feelings..."></textarea>
            <button onclick="sendFeedback()" style="background: #e91e63;">Submit Feedback</button>
        </div>
        
        <button onclick="location.reload()" style="background:#444; margin-top:20px; width: 100px;">Exit</button>
    </div>

    <div id="adminPage">
        <h2 style="color: #1a73e8;">Admin Dashboard</h2>
        
        <div class="card" style="background: #000; border: 2px solid #e91e63; margin-bottom: 30px;">
            <h3 style="color: #e91e63;">Feedback Inbox</h3>
            <button onclick="loadFeedbacks()" style="background: #333; font-size: 12px; margin-bottom: 10px;">Refresh Feedbacks</button>
            <div id="feedbackList" style="text-align: left; max-height: 250px; overflow-y: auto;">
                Click refresh to see feedbacks.
            </div>
        </div>

        <div id="adminInputs"></div>
        <button onclick="addUser()" style="background:#28a745; margin-bottom: 10px;">+ Add New Friend</button>
        <button onclick="saveAdminData()" style="background:#d32f2f;">Save All Changes</button>
        <button onclick="location.reload()" style="background:#333; margin-top:10px;">Back</button>
    </div>

    <script>
        const adminSecret = "867055"; // Admin login code
        const thingSpeakKey = "ZOMVHDCOLTH4GKMG"; // PUT YOUR WRITE API KEY HERE
        const channelID = "3235968";   // PUT YOUR CHANNEL ID HERE

        let users = JSON.parse(localStorage.getItem('bdayData')) || [];

        function checkCode() {
            const entered = document.getElementById("userCode").value;
            if (entered === adminSecret) {
                showAdmin();
                return;
            }
            let user = users.find(u => u.code === entered);
            if (user) {
                startBalloons();
                showUser(user);
            } else {
                alert("Incorrect Code! Try again.");
            }
        }

        function startBalloons() {
            for(let i=0; i<35; i++) {
                let b = document.createElement("div");
                b.className = "balloon";
                b.innerText = ["üéà","‚ú®","üéÇ","ü•≥","üéÅ","üíñ"][Math.floor(Math.random()*6)];
                b.style.left = Math.random() * 100 + "vw";
                b.style.animationDelay = Math.random() * 3 + "s";
                document.body.appendChild(b);
            }
        }

        function showUser(user) {
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("birthdayPage").style.display = "block";
            document.getElementById("dispName").innerText = user.name;
            document.getElementById("dispWish").innerText = user.wish;
            document.getElementById("dispAge").innerText = user.age;
            document.getElementById("dispDOB").innerText = user.dob;
            document.getElementById("dispMsg").innerText = user.msg;
            document.getElementById("dispSecret").innerText = user.secret;
            document.getElementById("giftSection").style.display = "block";
        }

        function openGift() {
            document.getElementById("secretMsg").style.display = "block";
            document.getElementById("giftSection").style.animation = "none";
            alert("Surprise! Secret Message Unlocked.");
        }

        function sendFeedback() {
            const fb = document.getElementById("feedbackInput").value;
            const code = document.getElementById("userCode").value;
            if(!fb) return;
            const fullFeedback = encodeURIComponent("Code[" + code + "]: " + fb);
            fetch(`https://api.thingspeak.com/update?api_key=${thingSpeakKey}&field3=${fullFeedback}`)
            .then(() => {
                alert("Feedback Sent Successfully!");
                document.getElementById("feedbackInput").value = "";
            });
        }

        function loadFeedbacks() {
            const list = document.getElementById("feedbackList");
            list.innerHTML = "Fetching...";
            fetch(`https://api.thingspeak.com/channels/${channelID}/fields/3.json?results=15`)
            .then(r => r.json()).then(data => {
                list.innerHTML = "";
                if(!data.feeds || data.feeds.length === 0) { list.innerHTML = "No feedbacks found."; return; }
                data.feeds.reverse().forEach(f => {
                    if(f.field3) {
                        list.innerHTML += `<div class="feedback-item">
                            ${f.field3} <br>
                            <small style="color: #666;">${new Date(f.created_at).toLocaleString()}</small>
                        </div>`;
                    }
                });
            });
        }

        function showAdmin() {
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("adminPage").style.display = "block";
            renderAdminUsers();
            loadFeedbacks();
        }

        function renderAdminUsers() {
            let container = document.getElementById("adminInputs");
            container.innerHTML = "";
            users.forEach((user, index) => {
                container.innerHTML += `
                    <div class="admin-item">
                        <strong>Friend Profile #${index + 1}</strong>
                        <input type="text" placeholder="Full Name" id="n${index}" value="${user.name}">
                        <input type="text" placeholder="DOB (e.g. 15th Aug)" id="d${index}" value="${user.dob}">
                        <input type="text" placeholder="Current Age" id="a${index}" value="${user.age}">
                        <input type="text" placeholder="Access Code" id="c${index}" value="${user.code}">
                        <input type="text" placeholder="Short Wish (e.g. HBD!)" id="w${index}" value="${user.wish}">
                        <textarea placeholder="Birthday Message" id="m${index}">${user.msg}</textarea>
                        <textarea placeholder="Secret Message (In Gift Box)" id="s${index}">${user.secret}</textarea>
                        <button onclick="users.splice(${index},1);renderAdminUsers();" style="background:#444; font-size:11px;">Remove Profile</button>
                    </div>`;
            });
        }

        function addUser() {
            users.push({ name:"", dob:"", age:"", code:"", wish:"", msg:"", secret:"" });
            renderAdminUsers();
        }

        function saveAdminData() {
            users = users.map((u, i) => ({
                name: document.getElementById(`n${i}`).value,
                dob: document.getElementById(`d${i}`).value,
                age: document.getElementById(`a${i}`).value,
                code: document.getElementById(`c${i}`).value,
                wish: document.getElementById(`w${i}`).value,
                msg: document.getElementById(`m${i}`).value,
                secret: document.getElementById(`s${i}`).value
            }));
            localStorage.setItem('bdayData', JSON.stringify(users));
            alert("Database Saved Successfully!");
        }
    </script>
</body>
</html>

        function addUser() {
            users.push({ id: Date.now(), name: "", code: "", msg: "" });
            renderAdminUsers();
        }

        function deleteUser(index) {
            if(confirm("Delete this user?")) {
                users.splice(index, 1);
                renderAdminUsers();
            }
        }

        function saveAdminData() {
            users = users.map((user, index) => ({
                id: user.id,
                name: document.getElementById(`n${index}`).value,
                code: document.getElementById(`c${index}`).value,
                msg: document.getElementById(`m${index}`).value
            }));
            localStorage.setItem('bdayData', JSON.stringify(users));
            alert("All Users Saved!");
        }
    </script>
</body>
</html>
